# `bodyParser` Middleware for Nested Properties

We've seen how naming our form's inputs exactly as the properties in a Mongoose model eases creating and updating data because we can simply provide `req.body` to Mongoose methods.

### Simple Example

#### Schema

```js
var userSchema = new mongoose.Schema({
	name: String,
	email: String
});
```

#### HTML Form

```html
<form method="POST" action="/users">
    <input type="text" name="name">
    <input type="text" name="email">
    <input type="submit" value="Add User">
</form>
```

#### `req.body` Will be

```js
{
	name: "some name",
	email: "email@domain.com"
}
```

#### Mongoose Code

```js
User.create(req.body, function(err, user) {
	res.redirect(`/users/${user._id}`, { user });
});
```

### Handling Nested Schema Properties

Now consider a schema where the user's name might be defined in the schema as follows...

#### Schema

```js
var userSchema = new mongoose.Schema({
	name: {
		first: String,
		last: String
	},
	email: String
});
```

#### HTML Form

How can we define our HTML form to be able to still be able to use `req.body` in the model's `create` method?

Well, examining a form generated by Rails for a model shows how it's done:

```html
<form method="POST" action="/users">
    <input type="text" name="name[first]">
    <input type="text" name="name[last]">
    <input type="text" name="email">
    <input type="submit" value="Add User">
</form>
```

Now we can still use the following code to create a `User`:

```js
User.create(req.body, function(err, user) {
	res.redirect(`/users/${user._id}`, { user });
});
```

But, only if `body-parser` middleware is configured correctly...

### `bodyParser` Configuration

If `bodyParser` is mounted as follows:

```js
// server.js
app.use(bodyParser.urlencoded({ extended: false }));
```

`req.body` will be formatted as:

```js
{"name[first]": "Sammy", "name[last]": "Hagar", "email": "email@domain.com"}
```

Obviously, the above will not work for nested schema properties.

Here's the solution

```
// server.js
app.use(bodyParser.urlencoded({ extended: true }));
```

`req.body` will now be formatted: 

```js
{
	"name": {
		"first": "Sammy",
		"last": "Hagar"
	},
	"email": "email@domain.com"
}
```
Bingo!

## Additional Resources

- [bodyParser](https://github.com/expressjs/body-parser)
- [http://expressjs.com/en/api.html#req.query](http://expressjs.com/en/api.html#req.query)
- [http://expressjs.com/en/api.html#req.body](http://expressjs.com/en/api.html#req.body)
- [http://expressjs.com/en/api.html#req.params](http://expressjs.com/en/api.html#req.params)
